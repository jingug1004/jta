<?xml version="1.0" encoding="utf-8"?>

<root>

<!-- 진행서류 상세목록 조회 -->
<query name="/retrieveDocPaperDetailList"><![CDATA[
SELECT A.LIST_SEQ
     , B.PAPER_NAME || '-' || C.PAPER_SUBNAME PAPER_FULL_NAME
     , A.PAPER_REF_NO
     , A.COMMENTS
     , A.PAPER_DATE
     , A.INPUT_OWNER
     , FN_COM_CODE_NAME('DOC_INPUT_OWNER', A.INPUT_OWNER, {@$LANG_CODE}, {@$DEFAULT_LANG_CODE}) INPUT_OWNER_NAME
     , A.URGENT_DATE
     , A.DUE_DATE
     , A.CRE_DATE
     , A.CONFIRM_DATE
     , DECODE(FN_PAPER_CONFIRM_OWNER(A.REF_ID, A.LIST_SEQ), NULL,'-', NVL(A.CONFIRM_DATE, '미확인')) CONFIRM_DATE2
FROM   TB_PAPER_LIST A
     , TB_PAPER_MGT_MST B
     , TB_PAPER_MGT_SUB C
WHERE  A.REF_ID = {@REF_ID}
AND    A.PAPER_CODE = B.PAPER_CODE
AND    A.PAPER_CODE = C.PAPER_CODE
AND    A.PAPER_SUBCODE = C.PAPER_SUBCODE
{#1}
ORDER BY A.PAPER_DATE DESC, A.LIST_SEQ DESC
]]></query>
<query name="/retrieveDocPaperDetailList/office"><![CDATA[
AND    A.OFFICE_DISP_YN = '1'
]]></query>
<query name="/retrieveDocPaperDetailList/inventor"><![CDATA[
AND    A.INVENTOR_DISP_YN = '1'
]]></query>

<!-- 진행서류 정보 조회 -->
<query name="/retrieveDocPaperInfo"><![CDATA[
SELECT PAPER_CODE
     , PAPER_NAME
     , PATTEAM_MAIL_YN
     , INOUT_DIV
     , OFFICE_DISP_YN
     , OFFICE_MAIL_YN
     , INVENTOR_DISP_YN
     , INVENTOR_MAIL_YN
     , OA_MGT_STEP
     , DUP_AVAIL_YN
     , BIZ_VIEW_PATH
     , INPUT_HELP
     , (SELECT DECODE(COUNT(1), 0,0, 1)
        FROM   TB_PAPER_MGT_EVENT_LIST
        WHERE  EVENT_SEQ = (SELECT EVENT_SEQ FROM TB_PAPER_MGT_EVENT WHERE EVENT_ID = 'OA_PERIOD_EXTEND')
        AND    PAPER_CODE = A.PAPER_CODE
       ) IS_OA_PERIOD_EXTEND
     , (SELECT COUNT(1) FROM TB_PAPER_LIST T WHERE T.REF_ID = {@REF_ID} AND PAPER_CODE = A.PAPER_CODE) PAPER_CNT
FROM   TB_PAPER_MGT_MST A
WHERE  PAPER_CODE = {@PAPER_CODE}
]]></query>

<!-- 진행서류 조회 -->
<query name="/retrieveDocPaper"><![CDATA[
SELECT A.LIST_SEQ
     , B.PAPER_NAME
     , C.PAPER_SUBNAME
     , A.CRE_DATE
     , A.PAPER_DATE
     , A.URGENT_DATE
     , A.DUE_DATE
     , A.PAPER_REF_NO
     , A.COMMENTS
     , A.REMARK
     , A.FILE_ID
     , A.OFFICE_DISP_YN
     , A.INVENTOR_DISP_YN
     , A.INPUT_OWNER
     , FN_PAPER_CONFIRM_OWNER(A.REF_ID, A.LIST_SEQ) CONFIRM_OWNER
     , A.CRE_USER
     , A.CONFIRM_DATE
     , DECODE(FN_PAPER_CONFIRM_OWNER(A.REF_ID, A.LIST_SEQ), NULL,'-', NVL(A.CONFIRM_DATE, '미확인')) CONFIRM_DATE2
     , B.INPUT_HELP
     , B.OA_MGT_STEP
     , NVL(B.BIZ_BUTTON_NAME, C.BIZ_BUTTON_NAME) BIZ_BUTTON_NAME
     , NVL(B.BIZ_VIEW_PATH, C.BIZ_VIEW_PATH) BIZ_VIEW_PATH
     , B.PATTEAM_INPUT_YN
     , B.INVENTOR_INPUT_YN
     , D.PAPER_CODE COPE_PAPER_CODE
     , D.BIZ_BUTTON_NAME COPE_BIZ_BUTTON_NAME
     , D.BIZ_VIEW_PATH COPE_BIZ_VIEW_PATH
     , D.PATTEAM_INPUT_YN COPE_PATTEAM_INPUT_YN
     , D.INVENTOR_INPUT_YN COPE_INVENTOR_INPUT_YN
     , B.PATTEAM_COPE_BUTTON
     , B.PATTEAM_COPE_VIEW
     , B.INVENTOR_COPE_BUTTON
     , B.INVENTOR_COPE_VIEW
     , (SELECT JOB_MAN FROM V_MASTER_ALL T WHERE T.REF_ID = A.REF_ID AND MST_DIV NOT IN ('C') ) JOB_MAN
FROM   TB_PAPER_LIST A
     , TB_PAPER_MGT_MST B
     , TB_PAPER_MGT_SUB C
     , (SELECT PAPER_CODE
             , BIZ_BUTTON_NAME
             , BIZ_VIEW_PATH
             , PATTEAM_INPUT_YN
             , INVENTOR_INPUT_YN
        FROM   TB_PAPER_MGT_MST
       ) D
WHERE  A.REF_ID = {@REF_ID}
AND    A.LIST_SEQ = {@LIST_SEQ}
AND    A.PAPER_CODE = B.PAPER_CODE
AND    A.PAPER_CODE = C.PAPER_CODE
AND    A.PAPER_SUBCODE = C.PAPER_SUBCODE
AND    B.COPE_PAPER_CODE = D.PAPER_CODE(+)
ORDER BY A.PAPER_DATE DESC, A.LIST_SEQ DESC
]]></query>

<!-- 진행서류 수정 -->
<query name="/updateDocPaper"><![CDATA[
UPDATE TB_PAPER_LIST SET
       PAPER_REF_NO     = {@PAPER_REF_NO}
     , COMMENTS         = {@COMMENTS}
     , PAPER_DATE       = {@PAPER_DATE}
     , URGENT_DATE      = {@URGENT_DATE}
     , DUE_DATE         = {@DUE_DATE}
     , REMARK           = {@REMARK}
     , FILE_ID          = {@FILE_ID}
     , OFFICE_DISP_YN   = {@OFFICE_DISP_YN}
     , INVENTOR_DISP_YN = {@INVENTOR_DISP_YN}
     , UPD_USER         = {@$USER_ID}
     , UPD_DATE         = TO_CHAR(SYSDATE, 'YYYYMMDD')
WHERE  REF_ID = {@REF_ID}
AND    LIST_SEQ = {@LIST_SEQ}
]]></query>

<!-- 진행서류 확인처리 -->
<query name="/confirmDocPaper"><![CDATA[
UPDATE TB_PAPER_LIST SET
       CONFIRM_DATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
WHERE  REF_ID = {@REF_ID}
AND    LIST_SEQ = {@LIST_SEQ}
]]></query>

</root>
